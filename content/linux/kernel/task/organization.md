---
title: "Organization of Tasks: Thread, Task Group, and Session"
date: 2024-01-01
lastmod: 2024-05-01
draft: true
---

Process group and session are concepts built into the kernel's task model sorely to implement a feature known as the job control of a shell.

In the normal operation of a shell
- A process group models all processes in the same pipeline
- A session models the lifecycle from a user's login to logout

It's kinda weird to see such a high-level userspace feature to have seminal effects on the kernel's task model, but this is part of Linux already.

## process group / session / controlling terminal / job control

A process that is not a group leader (\*) may call `setsid(2)` to start a new session and become the session leader of that new session.
It also becomes the group leader of the only process group in that new session.

\* this restriction is imposed to avoid the complexity where process group members will lose their group leader.

When a session leader `open(2)` a device node backed by a tty driver (with character device major 4 (for real tty) or 136 to 143 (for pseudo tty)),
this terminal (specifically, the `struct cdev` instance registered by that tty driver), is said to be the controlling terminal of that session (unless `O_NOCTTY` flag is used).

On a real tty, certain 

Signals can be generated by certain key combination on a terminal (e.g. Ctrl-C for `SIGINT`), which are forwarded
to the session which use that terminal as its controlling terminal.

One and only one process group is said to be the *foreground job* of a session.
other jobs in the session are background jobs.
Only the foreground job may read from the terminal; when a  process
in the background attempts to read from the terminal, its process group is sent a SIGTTIN
signal,  which  suspends  the job.  If the TOSTOP flag has been set for the terminal (see
termios(3)), then only the foreground job may write to the terminal;  writes  from  back‐
ground  jobs cause a SIGTTOU signal to be generated, which suspends the job.  When termi‐
nal keys that generate a signal (such as  the  interrupt  key,  normally  control-C)  are
pressed, the signal is sent to the processes in the foreground job.

Controlling terminal will 

Controlling terminal is very different from the terminal associated with `stdin` (if any) of a process.

