---
title: "Misc x86 Considerations"
date: 2024-01-01
lastmod: 2024-05-01
draft: false
tags:
- CPU
- x86
---

#### Implicit operands

Encoding operands is expensive. For example, Intel 8080 (and many other microprocessors of its age) encodes all instructions into 1 byte.
The `MOV` has an opcode of `01` and takes 2 register operands, which consumed the space `01xxxxxx` already. This leaves little room for other instructions. Later x86 CPUs do so for the same reason.

Using implicit operands, instead of allowing (specifying registers as) operands, makes programs compact.


### Alignment

It is recommended for maximum performance, but not mandatory, that words be aligned at even-numbered addresses and doublewords be aligned at addresses evenly divisible by four.

> When used in a configuration with a 32-bit bus, actual
> transfers of data between processor and memory take place in units of
> doublewords beginning at addresses evenly divisible by four; however, the
> processor converts requests for misaligned words or doublewords into the
> appropriate sequences of requests acceptable to the memory interface. Such
> misaligned data transfers reduce performance by requiring extra memory
> cycles.

There is no requirement for instructions to be aligned on word or
doubleword boundaries. (However, a slight increase in speed results if the
target addresses of control transfers are evenly divisible by four.)

## Glossary

- virtual memory: this phrase originally refers to the practice of temporarily moving unused data from main memory to the hard drive to make room for active software that requires large memory resources. For 80286 the unit of such swap is a segment, since demand-page is not implemented for that CPU.
However For all later models. The phrase *virtual memory* has nothing to do with the isolation of the address space between each process.

- demand-paging: ; such a system is said to be demand-paged.
- linear address space / processor's (addressable) memory space / processor's address space
- canonical address: In 64-bit mode, an address is considered to be in canonical form if address bits 63 through to the most-significant
implemented bit by the microarchitecture are set to either all ones or all zeros.

```
  63  ...    48   47
+---------------------------+
| 0 | ....  | 0 | FC5E ...  |
+---------------------------+
```


## MISC

<!-- These instructions are extremely microcoded, especially fbstp which often translates to 150-300 µops.
microcoded: 
µops: -->

## flags

fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good nopl nonstop_tsc cpuid extd_apicid aperfmperf rapl pni pclmulqdq monitor ssse3 fma cx16 sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand lahf_lm cmp_legacy svm extapic cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw ibs skinit wdt tce topoext perfctr_core perfctr_nb bpext perfctr_llc mwaitx cpb cat_l3 cdp_l3 hw_pstate ssbd mba ibrs ibpb stibp vmmcall fsgsbase bmi1 avx2 smep bmi2 erms invpcid cqm rdt_a rdseed adx smap clflushopt clwb sha_ni xsaveopt xsavec xgetbv1 xsaves cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local user_shstk clzero irperf xsaveerptr rdpru wbnoinvd arat npt lbrv svm_lock nrip_save tsc_scale vmcb_clean flushbyasid decodeassists pausefilter pfthreshold avic v_vmsave_vmload vgif v_spec_ctrl umip pku ospke vaes vpclmulqdq rdpid overflow_recov succor smca fsrm debug_swap

    fun fact: `XCHG` is commutative (no flag effect), making the order of ... insignificant.
    - A smart enough assembler should generate `91H` for both `XCHG EAX, ECX` and `XCHG ECX, EAX`

    ```sh
    # objdump -d -Mintel main.o
    00000000 <.text>:
    0:	91                   	xchg   ecx,eax
    1:	87 c1                	xchg   ecx,eax
    3:	87 c8                	xchg   eax,ecx
    ```
  

## exception



<!-- This article discusses various exception and error code generated by x86 CPU.. -->

When DS or ES is loaded with a
new selector, e.g., by an LDS, LES, or MOV to ES, SS, or DS instruction, the bits in the access byte
are checked to verify legitimate descriptor type and access (see table 7-2). If any test fails, an error
code is pushed onto the stack identifying the selector involved

Violating the segment size limit
causes a General Protection exception with an error code of O.