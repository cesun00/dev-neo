---
title: "Repeatable Annotations"
date: 2024-01-01
lastmod: 2024-05-01
draft: false
---

Most annotations encountered from day to day are non-repeatable:
It's a syntax error if `@Component` or `@Configuration` is tagged twice on your Spring bean class.

Repeatable annotations are those which can be tagged more than once. To define a repeatable annotation, you must:
1. define annotation `MyRepeatable` itself with `@Repeatable(value = ...)` tagged, where the `value` field must be the `Class` instance of its so-called *container* annotation companion.
2. define the container annotation `MyRepeatableContainer`, whose value must be of type `MyRepeatable[]`.
3. ensure `@Target.value()` of `MyRepeatable` is a superset of that of `MyRepeatableContainer`.
4. ensure `MyRepeatableContainer` has a longer `@Retention.value` than `MyRepeatable`.

## Equivalence of Container and Multiple Occurrences

Given

```java
@Retention(RetentionPolicy.RUNTIME)
public @interface FooContainer {
    Foo[] value();
}
```

And

{{<columns>}}
    
```java
@Retention(RetentionPolicy.RUNTIME)
public @interface Foo {}

@FooContainer({@Foo, @Foo})
public class Service {}
```

<--->
    
```java
@Repeatable(FooContainer.class)
@Retention(RetentionPolicy.RUNTIME)
public @interface Foo {}

@Foo
@Foo
public class Service {}
```
    
{{</columns>}}


It is guaranteed by [the language specification](https://docs.oracle.com/javase/specs/jls/se11/html/jls-9.html#jls-9.7.5) that both syntaxes are equivalent, to the extent that the generated bytecode of `Service` class must be identical in both cases:

> If a declaration context or type context has multiple annotations of a repeatable annotation type T, then it is as if the context has no explicitly declared annotations of type T and one implicitly declared annotation of the containing annotation type of T.

The realization is that the left syntax has long been how people implement `@Repeatable` before Java 8, and Java 8's `@Repeatable` does nothing more than facilitate a long-existing practice.

Caveat: the equivalence only applies to multiple occurrences of a repeatable annotation;
the following generates different bytecode:

```java
@FooContainer({@Foo})
public class Service {}

